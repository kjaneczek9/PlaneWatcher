<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live @ LAX</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        .highlight { 
            background-color: #ffcccc;
        }
    </style>
</head>
<body>
    <h2>Live @ LAX</h2>
    <table id="aircraftTable">
        <thead>
            <tr>
                <th>Flight</th>
                <th>Aircraft</th>
                <th>Altitude (ft)</th>
                <th>Speed (knots)</th>
                <th>Track (Â°)</th>
                <th>Lat</th>
                <th>Lon</th>
                <th>Runway</th>
                <th>Destination</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const API_URL = "http://192.168.1.160:5000/api/plane_tracker";

        async function fetchAircraftData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                displayAircraftData(data);
            } catch (error) {
                console.error("Error fetching aircraft data:", error);
            }
        }

        function displayAircraftData(data) {
            const tableBody = document.querySelector("#aircraftTable tbody");
            tableBody.innerHTML = ""; // Clear previous data

            const allAircraft = [...data.CLOSE, ...data.FAR]; // Merges both resp

            if (allAircraft.length === 0) {
                tableBody.innerHTML = "<tr><td colspan='9'>No aircraft detected</td></tr>";
                return;
            }

            allAircraft.forEach(plane => {
                const highlightClass = /777|747|380/.test(plane.aircraft) ? "highlight" : "";
                const row = `
                    <tr>
                        <td class="${highlightClass}">${plane.flight.trim()}</td>
                        <td class="${highlightClass}">${plane.aircraft}</td>
                        <td class="${highlightClass}">${plane.altitude}</td>
                        <td class="${highlightClass}">${plane.speed}</td>
                        <td class="${highlightClass}">${plane.track}</td>
                        <td class="${highlightClass}">${plane.lat}</td>
                        <td class="${highlightClass}">${plane.lon}</td>
                        <td class="${highlightClass}">${plane.runway}</td>
                        <td class="${highlightClass}">${plane.destination || "Unknown"}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // 10 second fetch
        fetchAircraftData();
        setInterval(fetchAircraftData, 1000);
    </script>
</body>
</html>

